# ========== VTxMus 子项目配置 ==========
location /VTxMus/ {
    alias /www/wwwroot/darkstarlan.top/VTxMus/;
    index index.html;
    
    # Vue Router 历史模式支持（关键！）
    try_files $uri $uri/ /VTxMus/index.html;
    
    # 静态资源缓存
    location ~ .*\.(js|css|png|jpg|jpeg|gif|svg|ico|webp|woff|woff2|ttf|eot)$ {
        expires 30d;
        access_log off;
    }
}

# ========== VTxMus 网易云音乐 API 代理 ==========
# 注意：这两个 location 要放在 /VTxMus/ 配置块的外面（同级）
location /VTxMus/api/ {
    # 去掉 /VTxMus 前缀，转发到网易云音乐
    rewrite ^/VTxMus/api/(.*)$ /api/$1 break;
    
    proxy_pass https://music.163.com;
    proxy_set_header Host music.163.com;
    proxy_set_header Origin https://music.163.com;
    proxy_set_header Referer https://music.163.com;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;
    
    # 处理 Cookie
    proxy_cookie_domain music.163.com $host;
    
    # 禁用缓存
    proxy_buffering off;
    proxy_http_version 1.1;
}

location /VTxMus/eapi/ {
    # 去掉 /VTxMus 前缀，转发到网易云音乐
    rewrite ^/VTxMus/eapi/(.*)$ /eapi/$1 break;
    
    proxy_pass https://interface3.music.163.com;
    proxy_set_header Host interface3.music.163.com;
    proxy_set_header Origin https://interface3.music.163.com;
    proxy_set_header Referer https://interface3.music.163.com;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_ssl_server_name on;
    proxy_ssl_protocols TLSv1.2 TLSv1.3;
    
    # 处理 Cookie
    proxy_cookie_domain interface3.music.163.com $host;
    
    # 禁用缓存
    proxy_buffering off;
    proxy_http_version 1.1;
}

